{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport '@/assets/css/utility.css';\nimport { xmlToJson } from '@/assets/js/x2j.js';\nimport axios from \"axios\";\nimport drf from '@/api/drf';\nimport { mapGetters, mapActions } from 'vuex';\nimport Constant from \"@/common/Constant.js\";\nimport VueDrawingCanvas from \"vue-drawing-canvas\";\nconst __default__ = {\n  name: 'BaseUtilityView',\n  components: {\n    VueDrawingCanvas\n  },\n  props: {},\n  data: () => ({\n    tempOverlaies: \"\",\n    tempImage: \"\",\n    // disable: true,\n    disable: false,\n    rated: 0,\n    // Save marker\n    overlayes: [],\n    // Canvas\n    // cSize\n    canvasHeight: 0,\n    canvasWidth: 0,\n    // dSize\n    // sSize\n    // mm -> px\n    imageHeight: 1,\n    imageWidth: 1,\n    // 0, 0 coordinate set\n    maginTop: 0,\n    maginLeft: 0,\n    // reSizeScale\n    reSizeScale: 1,\n    // utility ===================================================\n    lock: true,\n    // 1\n    imageArr: [],\n    // 1-1\n    mouseFlag: false,\n    startTop: 0,\n    startLeft: 0,\n    movingTop: 0,\n    movingLeft: 0,\n    // 1-2\n    scale: 1.0,\n    // 1-3\n    startX: 0,\n    startY: 0,\n    endX: 0,\n    endY: 0,\n    // 2\n    brightness: 100,\n    inverse: 0,\n    // 3\n    lineColor: '#FF0000',\n    lineWidth: 1,\n    // 4\n    ang: 0,\n    rotX: 0,\n    rotY: 0,\n    // 1 f\n    first: {\n      pan: false,\n      zoom: false\n    },\n    // 2 s\n    second: {\n      bright: false,\n      inverse: false,\n      sharpen: false,\n      ruler: false,\n      tapeline: false,\n      draw: false\n    },\n    // 4 o\n    fourth: ['01', '02', '03', '04'],\n    mainImg: require('@/assets/img/board.png'),\n    // canvas\n    initialImage: [{\n      type: \"dash\",\n      from: {\n        x: 262,\n        y: 154\n      },\n      coordinates: [],\n      color: '#FF0000',\n      width: 1,\n      fill: false\n    }],\n    downFlag: false,\n    x: 0,\n    y: 0,\n    preX: 0,\n    preY: 0,\n    image: \"\",\n    strokeType: \"dash\",\n    fillShape: false,\n    backgroundImage: null\n  }),\n  mounted() {\n    window.addEventListener('resize', this.handleResize);\n    const canvas = document.getElementById('canvas');\n    this.canvasHeight = canvas.clientHeight;\n    this.canvasWidth = canvas.clientWidth;\n\n    /*if (\"vue-drawing-canvas\" in window.localStorage) {\r\n      this.initialImage = JSON.parse(\r\n          window.localStorage.getItem(\"vue-drawing-canvas\")\r\n      );\r\n    }*/\n  },\n\n  computed: {\n    ...mapGetters(['patientSeriesList'])\n  },\n  watch: {\n    patientSeriesList: {\n      deep: true,\n      handler() {\n        this.imageArr = [];\n        const ch = this.patientSeriesList.chartId;\n        this.patientSeriesList.entity.forEach(async e => {\n          const cr = e.Created;\n          // image\n          const url = await axios({\n            url: drf.patient.patientImgFileDownload(e.UniqueID),\n            method: 'get',\n            responseType: 'blob'\n          });\n          const im = URL.createObjectURL(new Blob([url.data], {\n            type: 'image/bmp'\n          }));\n          const dr = await axios({\n            url: drf.patient.drawImage(e.UniqueID),\n            method: 'get',\n            headers: {\n              \"Content-Type\": \"multipart/form-data\"\n            }\n          });\n\n          // xml to json\n          let XmlNode = new DOMParser().parseFromString(e.Tags, \"text/xml\");\n          const json = xmlToJson(XmlNode);\n          this.imageHeight = json.tags.tags[0].tag[1][\"@attributes\"].value * e.PixelSpacingH / 25.4 * 96;\n          this.imageWidth = json.tags.tags[0].tag[0][\"@attributes\"].value * e.PixelSpacingV / 25.4 * 96;\n\n          // 이미지 마다 다른 것\n          this.imageArr.push({\n            // 차트ID\n            chartId: ch,\n            // 마커 정보\n            images: im,\n            // 마커 파일\n            drawMark: dr,\n            // 생성 일자\n            create: cr,\n            // 너비\n            pw: this.imageHeight,\n            // 높이\n            ph: this.imageWidth,\n            // 마커 배열\n            overl: dr.data.overlaies\n          });\n          this.disable = true;\n          this.tempOverlaies = dr.data.overlaies;\n          this.tempImage = im;\n          // 마커 배열, y축 이미지 비율 크기, 팬 타입\n          this.mainImg = this.tempImage;\n          await this.setCanvasScale();\n          await this.importImageDrawing();\n        });\n      }\n    }\n  },\n  created() {},\n  methods: {\n    async handleResize() {\n      let canvas = document.getElementById('canvas');\n      if (this.$refs.VueCanvasDrawing.angle === 90 || this.$refs.VueCanvasDrawing.angle === 270) {\n        this.canvasHeight = canvas.clientWidth;\n        this.canvasWidth = canvas.clientHeight;\n      } else {\n        this.canvasHeight = canvas.clientHeight;\n        this.canvasWidth = canvas.clientWidth;\n      }\n\n      // await this.setCanvasScale();\n      [this.reSizeScale] = await Promise.all([Math.min(this.canvasHeight / this.imageHeight, this.canvasWidth / this.imageWidth)]);\n      // 1. 스케일 -> 캔바스 스케일을 높이와 너비 중 짧은 걸 기준으로 맞춤\n      this.$refs.VueCanvasDrawing.context.scale(this.reSizeScale, this.reSizeScale);\n      // 2. 트랜스레이트 -> 화면의 중앙으로 이동\n      this.$refs.VueCanvasDrawing.context.translate(this.canvasWidth / this.reSizeScale / 2.0, this.canvasHeight / this.reSizeScale / 2.0);\n      // 3. 로테이트 -> 효과 적용\n      this.$refs.VueCanvasDrawing.context.rotate(Math.PI / 180 * this.$refs.VueCanvasDrawing.angle);\n      // 4. 트랜스레이트 -> 화면의 중앙에서 그림 박기 위한 0, 0으로 이동\n      /*this.$refs.VueCanvasDrawing.context.translate(this.imageWidth / -2.0, this.imageHeight / -2.0);\r\n      // 5. 배경화면 설정\r\n      await this.$refs.VueCanvasDrawing.drawBackgroundImage();\r\n      // 6. 그리기 위해 다시 원점 중앙 이동\r\n      this.$refs.VueCanvasDrawing.context.translate(this.imageWidth / 2.0, this.imageHeight / 2.0);*/\n      await this.$refs.VueCanvasDrawing.redraw();\n    },\n    checkedToggling(idx, name, bool) {\n      if (this.disable) {\n        if (idx[name] === bool) {\n          this.first.pan = false;\n          this.second.bright = false;\n          this.second.ruler = false;\n          this.second.tapeline = false;\n          this.second.draw = false;\n          idx[name] = !bool;\n        }\n      }\n    },\n    // utility ===================================================\n    // 1-1\n    startMoving(e) {\n      if (this.first.pan && !this.mouseFlag) {\n        this.startTop = e.screenY;\n        this.startLeft = e.screenX;\n        this.mouseFlag = true;\n      }\n    },\n    moveImage(e) {\n      if (this.first.pan && this.mouseFlag) {\n        this.movingTop += e.screenY - this.startTop;\n        this.startTop = e.screenY;\n        this.movingLeft += e.screenX - this.startLeft;\n        this.startLeft = e.screenX;\n      }\n    },\n    endMoving() {\n      if (this.first.pan && this.mouseFlag) {\n        this.mouseFlag = false;\n      }\n    },\n    // 1-2\n    changedScale(e) {\n      if (this.first.zoom) {\n        const rate = 0.002;\n        if (e.deltaY > 0 && this.scale >= 0.5 + rate) this.scale -= rate;else if (e.deltaY < 0 && this.scale <= 2.0 - rate) this.scale += rate;\n      }\n    },\n    // 2-4\n    async startCoordinate(e) {\n      if (this.second.ruler) {\n        this.getCoordinate(e);\n        this.startX = this.x;\n        this.startY = this.y;\n      }\n    },\n    endCoordinate(e) {\n      if (this.second.ruler) {\n        this.getCoordinate(e);\n        this.endX = this.x;\n        this.endY = this.y;\n        this.getDistance([this.getWeb2One({\n          x: this.startX,\n          y: this.startY\n        }), this.getWeb2One({\n          x: this.endX,\n          y: this.endY\n        })]);\n      }\n    },\n    getDistance(arr) {\n      // const rate = this.pW / this.fullHeight;\n      // const pixelSpacing = 0.10000000149011612;\n      let distance = 0;\n      let x = arr[0].x;\n      let y = arr[0].y;\n      arr.forEach(a => {\n        distance += Math.pow(Math.pow(y - a.y, 2) + Math.pow(x - a.x, 2), 0.5);\n        x = a.x;\n        y = a.y;\n      });\n      // Number.EPSILON = 오차없이 나타낼수 있는 가장 작은 양의 수, 부동 소수점 오차를 보정\n      distance = Math.round((distance + Number.EPSILON) * 100) / 100;\n      return distance.toFixed(2);\n    },\n    // 2-1, 2-3\n    changedMouseEvent(e) {\n      if (this.downFlag && this.second.bright) {\n        this.lock = this.second.bright;\n        this.preX = this.x;\n        this.preY = this.y;\n        this.getCoordinate(e);\n        if (this.preX < this.x || this.preY < this.y) {\n          this.brightness += 2;\n        } else if (this.preX > this.x || this.preY > this.y) {\n          this.brightness -= 2;\n        }\n      }\n    },\n    // event\n    // 2-2, 4-1, 4-2, 4-3, 4-3\n    async changedEvent(e) {\n      if (this.disable) {\n        if (e === 'inverse') {\n          // Change Inverse\n          // 2-2\n          if (this.second[e] === true) this.inverse = 100;else this.inverse = 0;\n        } else if (typeof e === 'number') {\n          // Change Angle\n          // 4-1, 4-2, 4-3, 4-4\n          // @click=\"utilityEvent(i), send({'name' : k, 'state' : i }, [ang, rotX, rotY])\"\n          if (e === 0) {\n            this.$refs.VueCanvasDrawing.angle += 90;\n          } else if (e === 1) {\n            this.$refs.VueCanvasDrawing.angle -= 90;\n          } else if (e === 2) {\n            console.log(2);\n          } else if (e === 3) {\n            console.log(3);\n          }\n\n          /*if (e === 0) {\r\n            this.ang = (this.ang + 90) % 360\r\n          } else if (e === 1) {\r\n            if (this.ang === 0) this.ang = 360;\r\n            this.ang = (this.ang - 90) % 360\r\n          } else if (e === 2) {\r\n            if (this.ang === 90 || this.ang === 270) {\r\n              this.rotX = (this.rotX % 360) + 180;\r\n            } else {\r\n              this.rotY = (this.rotY % 360) + 180;\r\n            }\r\n          } else if (e === 3) {\r\n            if (this.ang === 0 || this.ang === 180) {\r\n              this.rotX = (this.rotX % 360) + 180;\r\n            } else {\r\n              this.rotY = (this.rotY % 360) + 180;\r\n            }\r\n          }*/\n          await this.drawing();\n          // await this.$refs.VueCanvasDrawing.context.rotate((Math.PI / 180) * this.$refs.VueCanvasDrawing.angle);\n          // await this.$refs.VueCanvasDrawing.redraw();\n        }\n        /*\r\n        // 화면 중앙에서 좌측 상단으로 변경\r\n        this.$refs.VueCanvasDrawing.context.translate(this.canvasWidth / this.reSizeScale / -2.0, this.canvasHeight / this.reSizeScale / -2.0);\r\n        */\n      }\n    },\n\n    // 2-4, 2-8, 2-9, 3-1\n    changedStrokeType(s) {\n      if (this.disable) {\n        if (s === 'zoom') {\n          this.lock = false;\n        } else if (s === 'ruler') {\n          this.strokeType = 'line';\n          this.lock = !this.second.ruler;\n        } else if (s === 'draw') {\n          this.strokeType = 'dash';\n          this.lock = !this.second.draw;\n        } else {\n          this.lock = true;\n        }\n      }\n    },\n    // 7-1, 7-2\n    clearView() {\n      this.first.pen = false;\n      this.first.zoom = false;\n      this.second.bright = false;\n      this.second.inverse = false;\n      this.second.sharpen = false;\n      this.scale = 1.0;\n      this.brightness = 100;\n      this.inverse = 0;\n      this.ang = 0;\n      this.rotX = 0;\n      this.rotY = 0;\n    },\n    /***\r\n     * One2         => Canvas  pen.style\r\n     * length       => line       0\r\n     * multi-length => tapeline\r\n     * angle        => line       0\r\n     * arrow        => line       1\r\n     * ellipse      => circle     1\r\n     * rectangle    => square     1\r\n     * freedraw     => dash       1\r\n     * */\n    // One2 --> Web\n    async importImageDrawing() {\n      this.$refs.VueCanvasDrawing.context.clearRect(0, 0, this.canvasWidth, this.canvasHeight);\n      // 2. 트랜스레이트 -> 화면의 중앙으로 이동\n      this.$refs.VueCanvasDrawing.context.translate(this.canvasWidth / this.reSizeScale / 2.0, this.canvasHeight / this.reSizeScale / 2.0);\n\n      // 3. 로테이트 -> 효과 적용\n      this.$refs.VueCanvasDrawing.context.rotate(Math.PI / 180 * this.$refs.VueCanvasDrawing.angle);\n      console.log('rotate angle ' + this.$refs.VueCanvasDrawing.angle);\n      // 4. 트랜스레이트 -> 화면의 중앙에서 그림 박기 위한 0, 0으로 이동\n      this.$refs.VueCanvasDrawing.context.translate(this.imageWidth / -2.0, this.imageHeight / -2.0);\n      await this.$refs.VueCanvasDrawing.setBackground();\n\n      // 5. 그리기 위해 다시 원점 중앙 이동\n      this.$refs.VueCanvasDrawing.context.translate(this.imageWidth / 2.0, this.imageHeight / 2.0);\n      for (const m of this.tempOverlaies) {\n        let distance;\n        // 선 속성 지정\n        this.lineColor = '#' + m.style.pen.color.substring(3, 9);\n        this.lineWidth = m.style.pen.width / this.reSizeScale;\n        const stroke = {\n          type: '',\n          from: {\n            x: 0,\n            y: 0\n          },\n          coordinates: [],\n          color: this.lineColor,\n          width: this.lineWidth,\n          fill: false,\n          lineCap: \"round\",\n          lineJoin: \"round\"\n        };\n        switch (m.type) {\n          case \"freedraw\":\n            stroke.type = \"dash\";\n            stroke.from.x = m.scene_pos['control-points'][0].x / 25.4 * 96;\n            stroke.from.y = m.scene_pos['control-points'][0].y / 25.4 * 96;\n            m.scene_pos['control-points'].forEach(p => {\n              stroke.coordinates.push({\n                x: p.x / 25.4 * 96,\n                y: p.y / 25.4 * 96\n              });\n            });\n            this.$refs.VueCanvasDrawing.drawShape(this.$refs.VueCanvasDrawing.context, stroke, false);\n            this.$refs.VueCanvasDrawing.images.push(stroke);\n            break;\n          case \"length\":\n            stroke.type = \"line\";\n            stroke.from.x = m.scene_pos.start.x / 25.4 * 96;\n            stroke.from.y = m.scene_pos.start.y / 25.4 * 96;\n            stroke.coordinates.push({\n              x: m.scene_pos.end.x / 25.4 * 96,\n              y: m.scene_pos.end.y / 25.4 * 96,\n              valueBox: m.scene_pos[\"value-box\"]\n            });\n            distance = this.getDistance([{\n              x: m.scene_pos.start.x,\n              y: m.scene_pos.start.y\n            }, {\n              x: m.scene_pos.end.x,\n              y: m.scene_pos.end.y\n            }]);\n            // 단위 표시하기\n            this.$refs.VueCanvasDrawing.context.fillStyle = \"#ffff00\";\n            this.$refs.VueCanvasDrawing.context.fillText(distance + ' mm', m.scene_pos[\"value-box\"].x / 25.4 * 96, m.scene_pos[\"value-box\"].y / 25.4 * 96);\n            this.$refs.VueCanvasDrawing.drawShape(this.$refs.VueCanvasDrawing.context, stroke, false);\n            this.$refs.VueCanvasDrawing.images.push(stroke);\n            break;\n          case \"multi-length\":\n            stroke.type = \"tapeline\";\n            stroke.from.x = m.scene_pos['control-points'][0].x / 25.4 * 96;\n            stroke.from.y = m.scene_pos['control-points'][0].y / 25.4 * 96;\n            m.scene_pos['control-points'].forEach(p => {\n              stroke.coordinates.push({\n                x: p.x / 25.4 * 96,\n                y: p.y / 25.4 * 96\n              });\n            });\n            distance = this.getDistance(m.scene_pos['control-points']);\n            // 단위 표시하기\n            this.$refs.VueCanvasDrawing.context.fillStyle = \"#ffff00\";\n            this.$refs.VueCanvasDrawing.context.fillText(distance + ' mm', m.scene_pos[\"value-box\"].x / 25.4 * 96, m.scene_pos[\"value-box\"].y / 25.4 * 96);\n            this.$refs.VueCanvasDrawing.drawShape(this.$refs.VueCanvasDrawing.context, stroke, false);\n            this.$refs.VueCanvasDrawing.images.push(stroke);\n            break;\n        }\n      }\n      // this.$refs.VueCanvasDrawing.context.restore();\n    },\n\n    async setCanvasScale() {\n      this.$refs.VueCanvasDrawing.context.save();\n      this.$refs.VueCanvasDrawing.context.font = \"10px serif\";\n      this.$refs.VueCanvasDrawing.context.textAlign = \"start\";\n      this.$refs.VueCanvasDrawing.context.textBaseline = \"alphabetic\";\n      this.reSizeScale = Math.min(this.canvasHeight / this.imageHeight, this.canvasWidth / this.imageWidth);\n      // 1. 스케일 -> 캔바스 스케일을 높이와 너비 중 짧은 걸 기준으로 맞춤\n      this.$refs.VueCanvasDrawing.context.scale(this.reSizeScale, this.reSizeScale);\n      console.log('set Canvas Scale:: ' + this.reSizeScale);\n    },\n    async drawing() {\n      // await this.setCanvasScale();\n      const canvasHeight = Number(this.height);\n      const canvasWidth = Number(this.width);\n      const pixelspacing = 0.100000001;\n      let dHeight = this.$refs.VueCanvasDrawing.loadedImage.height * pixelspacing / 25.4 * 96;\n      let dWidth = this.$refs.VueCanvasDrawing.loadedImage.width * pixelspacing / 25.4 * 96;\n      this.$refs.VueCanvasDrawing.context.clearRect(canvasWidth / -2.0, canvasHeight / -2.0, canvasWidth, canvasHeight);\n      // 2. 트랜스레이트 -> 화면의 중앙으로 이동\n      // 4. 트랜스레이트 -> 화면의 중앙에서 그림 박기 위한 0, 0으로 이동\n      this.$refs.VueCanvasDrawing.context.translate(dWidth / -2.0, dHeight / -2.0);\n      await this.$refs.VueCanvasDrawing.setBackground().then(() => {\n        if (this.context) {\n          // 5. 그리기 위해 다시 원점 중앙 이동\n          this.$refs.VueCanvasDrawing.context.translate(dWidth / 2.0, dHeight / 2.0);\n          this.$refs.VueCanvasDrawing.images.forEach(stroke => {\n            if (stroke.type !== 'circle' || stroke.type === 'circle' && stroke.coordinates.length > 0) {\n              this.$refs.VueCanvasDrawing.drawShape(this.$refs.VueCanvasDrawing.context, stroke, stroke.type === 'eraser' || stroke.type === 'dash' || stroke.type === 'line' || stroke.type === 'tapeline' || stroke.type === 'angle' || stroke.type === 'arrow' ? false : true);\n            }\n          });\n        }\n      });\n    },\n    // Web --> One2\n    async save() {\n      await this.getRefImage2Overlayes();\n      var data = {\n        \"manipulate\": {\n          \"effect\": {\n            \"invert\": this.second.inverse,\n            \"sharpen\": 0\n          },\n          \"windowing\": {\n            \"wc\": 1000,\n            \"ww\": 4000\n          }\n        },\n        \"overlaies\": this.overlayes\n      };\n\n      // const obj = JSON.parse(json);\n      const s = JSON.stringify(data);\n      axios({\n        url: drf.patient.saveDrwingMarker('1.2.410.200062.2.1.20221222144825737.86.125615.843.799'),\n        method: 'post',\n        data: s\n      });\n    },\n    // async setImage(event) {\n    //   let URL = window.URL;\n    //   this.backgroundImage = URL.createObjectURL(event.target.files[0]);\n    //   await this.$refs.VueCanvasDrawing.redraw();\n    // },\n\n    getCoordinate(event) {\n      if (this.disable) {\n        let coordinates = this.$refs.VueCanvasDrawing.getCoordinates(event);\n        this.x = coordinates.x;\n        this.y = coordinates.y;\n      }\n    },\n    getWeb2One(coordiX, coordiY) {\n      return {\n        x: (coordiX - this.maginLeft) / this.rated,\n        y: (coordiY - this.canvasHeight) / this.rated\n      };\n    },\n    /***\r\n     * Canvas     => One2         pen.style\r\n     * line       => length         0\r\n     * tapeline   => multi-length\r\n     * angle      => angle          0\r\n     * arrow      => arrow          1\r\n     * ellipse    => circle         1\r\n     * rectangle  => square         1\r\n     * dash       => freedraw       1\r\n     * */\n    // Web --> One2\n    getRefImage2Overlayes() {\n      this.$refs.VueCanvasDrawing.images.forEach(e => {\n        const data = {\n          \"style\": {}\n        };\n        let coordi, coordi2;\n        const scene_pos = {};\n        const start = {},\n          end = {};\n        const value_box = {};\n        let dataType;\n        let newArr;\n        switch (e.type) {\n          case \"dash\":\n            newArr = e.coordinates.map(c => {\n              coordi = this.getWeb2One(c.x, c.y);\n              return {\n                x: coordi.x,\n                y: coordi.y\n              };\n            });\n            scene_pos[\"control-points\"] = newArr;\n            data[\"style\"][\"brush\"] = {\n              \"color\": \"#00ffffff\"\n            };\n            dataType = \"freedraw\";\n            break;\n          case \"line\":\n            coordi = this.getWeb2One(e.from.x, e.from.y);\n            start[\"x\"] = coordi.x;\n            start[\"y\"] = coordi.y;\n            coordi = this.getWeb2One(e.coordinates[0].x, e.coordinates[0].y);\n            end[\"x\"] = coordi.x;\n            end[\"y\"] = coordi.y;\n            value_box[\"x\"] = e.coordinates[0].valueBox.x;\n            value_box[\"y\"] = e.coordinates[0].valueBox.y;\n            scene_pos[\"start\"] = start;\n            scene_pos[\"end\"] = end;\n            scene_pos[\"value-box\"] = value_box;\n            data[\"style\"][\"value-box\"] = {\n              \"brush\": {\n                \"color\": \"#00ffffff\"\n              },\n              \"pen\": {\n                \"cap\": 32,\n                \"color\": \"#00ffffff\",\n                \"join\": 128,\n                \"style\": 0,\n                \"width\": 0\n              },\n              \"text\": {\n                \"color\": \"#ffffd700\",\n                \"font-size\": 12\n              }\n            };\n            dataType = \"length\";\n            break;\n          case \"tapeline\":\n            break;\n          case \"angle\":\n            break;\n          case \"arrow\":\n            coordi = this.getWeb2One(e.from.x, e.from.y);\n            start[\"x\"] = coordi.x;\n            start[\"y\"] = coordi.y;\n            coordi = this.getWeb2One(e.coordinates[0].x, e.coordinates[0].y);\n            end[\"x\"] = coordi.x;\n            end[\"y\"] = coordi.y;\n            scene_pos[\"start\"] = start;\n            scene_pos[\"end\"] = end;\n            data[\"style\"][\"brush\"] = {\n              \"color\": \"#00ffffff\"\n            };\n            dataType = \"arrow\";\n            break;\n          case \"circle\":\n            coordi = this.getWeb2One(e.coordinates[0].x - e.coordinates[1].x, e.coordinates[0].y - e.coordinates[1].y);\n            coordi2 = this.getWeb2One(e.coordinates[0].x + e.coordinates[1].x, e.coordinates[0].y + e.coordinates[1].y);\n            scene_pos[\"bottom\"] = coordi2.y;\n            scene_pos[\"left\"] = coordi.x;\n            scene_pos[\"right\"] = coordi2.x;\n            scene_pos[\"top\"] = coordi.y;\n            data[\"style\"][\"brush\"] = {\n              \"color\": \"#00ffffff\"\n            };\n            dataType = \"ellipse\";\n            break;\n          case \"square\":\n            // from:: 시작점, left - top\n            coordi = this.getWeb2One(e.coordinates[3].x, e.coordinates[3].y);\n            coordi2 = this.getWeb2One(e.coordinates[1].x, e.coordinates[1].y);\n            scene_pos[\"bottom\"] = coordi2.y;\n            scene_pos[\"left\"] = coordi.x;\n            scene_pos[\"right\"] = coordi2.x;\n            scene_pos[\"top\"] = coordi.y;\n            data[\"style\"][\"brush\"] = {\n              \"color\": \"#00ffffff\"\n            };\n            dataType = \"rectangle\";\n            break;\n        }\n        if (e.coordinates.length !== 0) {\n          // 1. scene_pos\n          data[\"scene_pos\"] = scene_pos;\n          // 2. style\n          data[\"style\"][\"pen\"] = {\n            \"cap\": 32,\n            \"color\": '#ff' + e.color.substring(1),\n            \"join\": 128,\n            \"style\": 1,\n            \"width\": e.width\n          };\n          // 3. transformation\n          data[\"transformation\"] = {\n            \"rot_deg\": 0\n          };\n          // 4. type\n          data[\"type\"] = dataType;\n          this.overlayes.push(data);\n        }\n      });\n    },\n    ...mapActions([Constant.GET_PATIENTSERIESLIST])\n  }\n};\nimport { useCssVars as _useCssVars } from 'vue';\nconst __injectCSSVars__ = () => {\n  _useCssVars(_ctx => ({\n    \"635c36aa-canvasHeight\": _ctx.canvasHeight,\n    \"635c36aa-canvasWidth\": _ctx.canvasWidth,\n    \"635c36aa-movingTop\": _ctx.movingTop,\n    \"635c36aa-movingLeft\": _ctx.movingLeft\n  }));\n};\nconst __setup__ = __default__.setup;\n__default__.setup = __setup__ ? (props, ctx) => {\n  __injectCSSVars__();\n  return __setup__(props, ctx);\n} : __injectCSSVars__;\nexport default __default__;","map":{"version":3,"mappings":"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","names":["xmlToJson","axios","drf","mapGetters","mapActions","Constant","VueDrawingCanvas","__default__","name","components","props","data","tempOverlaies","tempImage","disable","rated","overlayes","canvasHeight","canvasWidth","imageHeight","imageWidth","maginTop","maginLeft","reSizeScale","lock","imageArr","mouseFlag","startTop","startLeft","movingTop","movingLeft","scale","startX","startY","endX","endY","brightness","inverse","lineColor","lineWidth","ang","rotX","rotY","first","pan","zoom","second","bright","sharpen","ruler","tapeline","draw","fourth","mainImg","require","initialImage","type","from","x","y","coordinates","color","width","fill","downFlag","preX","preY","image","strokeType","fillShape","backgroundImage","mounted","window","addEventListener","handleResize","canvas","document","getElementById","clientHeight","clientWidth","computed","watch","patientSeriesList","deep","handler","ch","chartId","entity","forEach","e","cr","Created","url","patient","patientImgFileDownload","UniqueID","method","responseType","im","URL","createObjectURL","Blob","dr","drawImage","headers","XmlNode","DOMParser","parseFromString","Tags","json","tags","tag","value","PixelSpacingH","PixelSpacingV","push","images","drawMark","create","pw","ph","overl","overlaies","setCanvasScale","importImageDrawing","created","methods","$refs","VueCanvasDrawing","angle","Promise","all","Math","min","context","translate","rotate","PI","redraw","checkedToggling","idx","bool","startMoving","screenY","screenX","moveImage","endMoving","changedScale","rate","deltaY","startCoordinate","getCoordinate","endCoordinate","getDistance","getWeb2One","arr","distance","a","pow","round","Number","EPSILON","toFixed","changedMouseEvent","changedEvent","console","log","drawing","changedStrokeType","s","clearView","pen","clearRect","setBackground","m","style","substring","stroke","lineCap","lineJoin","scene_pos","p","drawShape","start","end","valueBox","fillStyle","fillText","save","font","textAlign","textBaseline","height","pixelspacing","dHeight","loadedImage","dWidth","then","length","getRefImage2Overlayes","JSON","stringify","saveDrwingMarker","event","getCoordinates","coordiX","coordiY","coordi","coordi2","value_box","dataType","newArr","map","c","GET_PATIENTSERIESLIST"],"sourceRoot":"","sources":["C:\\Users\\Osstem\\Desktop\\OS_Demo_FrontEnd\\GUI_Simple\\src\\components\\BaseHaederView.vue"],"sourcesContent":["<template>\r\n  <div class=\"baseHeaderView\">\r\n    <div class=\"utilityView\">\r\n      <div class=\"itemBox\">\r\n        <div\r\n            class=\"item\"\r\n            v-for=\"(v, k) in first\" :key=\"k\"\r\n            @click=\"checkedToggling(first, k, v), changedStrokeType(k)\"\r\n            :class=\"{isToggle:v && disable}\">\r\n          <img :src=\"require(`@/assets/img/utils/icon-${k}.png`)\"/>\r\n        </div>\r\n      </div>\r\n      <div class=\"line\"></div>\r\n\r\n      <div class=\"itemBox\">\r\n        <div\r\n            class=\"item\"\r\n            v-for=\"(v, k) in second\" :key=\"k\"\r\n            @click=\"checkedToggling(second, k, v), changedStrokeType(k), changedEvent(k)\"\r\n            :class=\"{isToggle:v && disable}\">\r\n          <img :src=\"require(`@/assets/img/utils/icon-${k}.png`)\"/>\r\n        </div>\r\n        <div>\r\n          <input type=\"color\" class=\"item\" v-model=\"lineColor\"/>\r\n        </div>\r\n        <select class=\"colorSelect\" v-model=\"lineWidth\">\r\n          <option v-for=\"n in 25\" :key=\"n\" :value=\"n\">\r\n            {{ n }}\r\n          </option>\r\n        </select>\r\n      </div>\r\n      <div class=\"line\"></div>\r\n\r\n      <div class=\"itemBox\">\r\n        <div\r\n            class=\"item\"\r\n            v-for=\"(k, i) in fourth\" :key=\"k\"\r\n            @click=\"changedEvent(i)\">\r\n          <img :src=\"require(`@/assets/img/utils/icon-${k}.png`)\"/>\r\n        </div>\r\n      </div>\r\n      <div class=\"line\"></div>\r\n\r\n      <div class=\"itemBox\">\r\n        <button class=\"item same\" @click.prevent=\"$refs.VueCanvasDrawing.undo()\">U</button>\r\n        <button class=\"item same\" @click.prevent=\"$refs.VueCanvasDrawing.redo()\">R</button>\r\n        <button class=\"item same\" @click.prevent=\"save\">S</button>\r\n        <!-- 회전 초기화-->\r\n        <button class=\"item same\" @click=\"clearView\">View</button>\r\n        <!-- 회전, 그림 초기화-->\r\n        <button class=\"item same\" @click=\"clearView\" @click.prevent=\"$refs.VueCanvasDrawing.reset()\">A</button>\r\n        {{ x }} {{ y }}\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"baseUtilityView\" id=\"canvas\"\r\n         @mousedown=\"startMoving($event)\"\r\n         @mousemove=\"moveImage($event)\"\r\n         @mouseup=\"endMoving\"\r\n         @mouseleave=\"endMoving\"\r\n    >\r\n      <VueDrawingCanvas\r\n          ref=\"VueCanvasDrawing\"\r\n          v-model:image=\"image\"\r\n          :stroke-type=\"strokeType\"\r\n          :fill-shape=\"fillShape\"\r\n          :backgroundImage=\"backgroundImage\"\r\n          :height=\"canvasHeight\"\r\n          :width=\"canvasWidth\"\r\n          :lock=\"lock\"\r\n          :color=lineColor\r\n          :lineWidth=lineWidth\r\n          @mousedown=\"downFlag = !downFlag, startCoordinate($event)\"\r\n          @mousemove=\"changedMouseEvent($event), getCoordinate($event)\"\r\n          @mouseup=\"downFlag = !downFlag, endCoordinate($event)\"\r\n          @wheel=\"changedScale\"\r\n          saveAs=\"png\"\r\n          line-cap=\"round\"\r\n          line-join=\"round\"\r\n          :initial-image=\"initialImage\"\r\n          :background-image=\"mainImg\"\r\n          classes=\"canvasEvent\"\r\n          :styles=\"{ }\"\r\n      />\r\n      <!--\r\n          :height=\"500\"\r\n          :width=\"500\"\r\n           -->\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport '@/assets/css/utility.css';\r\nimport {xmlToJson} from '@/assets/js/x2j.js';\r\n\r\nimport axios from \"axios\";\r\nimport drf from '@/api/drf';\r\nimport {mapGetters, mapActions} from 'vuex';\r\nimport Constant from \"@/common/Constant.js\";\r\nimport VueDrawingCanvas from \"vue-drawing-canvas\";\r\n\r\nexport default {\r\n  name: 'BaseUtilityView',\r\n\r\n  components: {\r\n    VueDrawingCanvas,\r\n  },\r\n\r\n  props: {},\r\n\r\n  data: () => ({\r\n    tempOverlaies: \"\",\r\n    tempImage: \"\",\r\n\r\n    // disable: true,\r\n    disable: false,\r\n    rated: 0,\r\n\r\n    // Save marker\r\n    overlayes: [],\r\n\r\n    // Canvas\r\n    // cSize\r\n    canvasHeight: 0,\r\n    canvasWidth: 0,\r\n\r\n    // dSize\r\n    // sSize\r\n    // mm -> px\r\n    imageHeight: 1,\r\n    imageWidth: 1,\r\n\r\n    // 0, 0 coordinate set\r\n    maginTop: 0,\r\n    maginLeft: 0,\r\n\r\n    // reSizeScale\r\n    reSizeScale: 1,\r\n\r\n\r\n    // utility ===================================================\r\n    lock: true,\r\n    // 1\r\n    imageArr: [],\r\n\r\n    // 1-1\r\n    mouseFlag: false,\r\n    startTop: 0,\r\n    startLeft: 0,\r\n    movingTop: 0,\r\n    movingLeft: 0,\r\n    // 1-2\r\n    scale: 1.0,\r\n    // 1-3\r\n    startX: 0,\r\n    startY: 0,\r\n    endX: 0,\r\n    endY: 0,\r\n\r\n    // 2\r\n    brightness: 100,\r\n    inverse: 0,\r\n    // 3\r\n    lineColor: '#FF0000',\r\n    lineWidth: 1,\r\n    // 4\r\n    ang: 0,\r\n    rotX: 0,\r\n    rotY: 0,\r\n\r\n    // 1 f\r\n    first: {\r\n      pan: false,\r\n      zoom: false,\r\n    },\r\n    // 2 s\r\n    second: {\r\n      bright: false,\r\n      inverse: false,\r\n      sharpen: false,\r\n      ruler: false,\r\n      tapeline: false,\r\n      draw: false\r\n    },\r\n    // 4 o\r\n    fourth: ['01', '02', '03', '04'],\r\n\r\n    mainImg: require('@/assets/img/board.png'),\r\n\r\n    // canvas\r\n    initialImage: [{\r\n      type: \"dash\",\r\n      from: {\r\n        x: 262,\r\n        y: 154,\r\n      },\r\n      coordinates: [],\r\n      color: '#FF0000',\r\n      width: 1,\r\n      fill: false,\r\n    }],\r\n\r\n    downFlag: false,\r\n    x: 0,\r\n    y: 0,\r\n    preX: 0,\r\n    preY: 0,\r\n    image: \"\",\r\n    strokeType: \"dash\",\r\n    fillShape: false,\r\n    backgroundImage: null,\r\n  }),\r\n\r\n  mounted() {\r\n    window.addEventListener('resize', this.handleResize);\r\n    const canvas = document.getElementById('canvas');\r\n    this.canvasHeight = canvas.clientHeight;\r\n    this.canvasWidth = canvas.clientWidth;\r\n\r\n    /*if (\"vue-drawing-canvas\" in window.localStorage) {\r\n      this.initialImage = JSON.parse(\r\n          window.localStorage.getItem(\"vue-drawing-canvas\")\r\n      );\r\n    }*/\r\n  },\r\n\r\n  computed: {\r\n    ...mapGetters([\r\n      'patientSeriesList',\r\n    ]),\r\n  },\r\n\r\n  watch: {\r\n    patientSeriesList: {\r\n      deep: true,\r\n      handler() {\r\n        this.imageArr = [];\r\n\r\n        const ch = this.patientSeriesList.chartId;\r\n        this.patientSeriesList.entity.forEach(async e => {\r\n          const cr = e.Created;\r\n          // image\r\n          const url = await axios({\r\n            url: drf.patient.patientImgFileDownload(e.UniqueID),\r\n            method: 'get',\r\n            responseType: 'blob',\r\n          })\r\n          const im = URL.createObjectURL(new Blob([url.data], {type: 'image/bmp'}));\r\n\r\n          const dr = await axios({\r\n            url: drf.patient.drawImage(e.UniqueID),\r\n            method: 'get',\r\n            headers: {\r\n              \"Content-Type\": \"multipart/form-data\"\r\n            }\r\n          })\r\n\r\n          // xml to json\r\n          let XmlNode = new DOMParser().parseFromString(e.Tags, \"text/xml\");\r\n          const json = xmlToJson(XmlNode);\r\n          this.imageHeight = (json.tags.tags[0].tag[1][\"@attributes\"].value * e.PixelSpacingH) / 25.4 * 96;\r\n          this.imageWidth = (json.tags.tags[0].tag[0][\"@attributes\"].value * e.PixelSpacingV) / 25.4 * 96;\r\n\r\n          // 이미지 마다 다른 것\r\n          this.imageArr.push({\r\n            // 차트ID\r\n            chartId: ch,\r\n            // 마커 정보\r\n            images: im,\r\n            // 마커 파일\r\n            drawMark: dr,\r\n            // 생성 일자\r\n            create: cr,\r\n            // 너비\r\n            pw: this.imageHeight,\r\n            // 높이\r\n            ph: this.imageWidth,\r\n            // 마커 배열\r\n            overl: dr.data.overlaies,\r\n          })\r\n          this.disable = true;\r\n\r\n          this.tempOverlaies = dr.data.overlaies;\r\n          this.tempImage = im;\r\n          // 마커 배열, y축 이미지 비율 크기, 팬 타입\r\n          this.mainImg = this.tempImage;\r\n\r\n          await this.setCanvasScale();\r\n          await this.importImageDrawing();\r\n        })\r\n      }\r\n    }\r\n  },\r\n\r\n  created() {\r\n  },\r\n\r\n  methods: {\r\n    async handleResize() {\r\n      let canvas = document.getElementById('canvas');\r\n      if (this.$refs.VueCanvasDrawing.angle === 90 || this.$refs.VueCanvasDrawing.angle === 270) {\r\n        this.canvasHeight = canvas.clientWidth;\r\n        this.canvasWidth = canvas.clientHeight;\r\n      } else {\r\n        this.canvasHeight = canvas.clientHeight;\r\n        this.canvasWidth = canvas.clientWidth;\r\n      }\r\n\r\n      // await this.setCanvasScale();\r\n      [this.reSizeScale] = await Promise.all([Math.min(this.canvasHeight / this.imageHeight, this.canvasWidth / this.imageWidth)]);\r\n      // 1. 스케일 -> 캔바스 스케일을 높이와 너비 중 짧은 걸 기준으로 맞춤\r\n      this.$refs.VueCanvasDrawing.context.scale(this.reSizeScale, this.reSizeScale);\r\n      // 2. 트랜스레이트 -> 화면의 중앙으로 이동\r\n      this.$refs.VueCanvasDrawing.context.translate(this.canvasWidth / this.reSizeScale / 2.0, this.canvasHeight / this.reSizeScale / 2.0);\r\n      // 3. 로테이트 -> 효과 적용\r\n      this.$refs.VueCanvasDrawing.context.rotate((Math.PI / 180) * this.$refs.VueCanvasDrawing.angle);\r\n      // 4. 트랜스레이트 -> 화면의 중앙에서 그림 박기 위한 0, 0으로 이동\r\n      /*this.$refs.VueCanvasDrawing.context.translate(this.imageWidth / -2.0, this.imageHeight / -2.0);\r\n      // 5. 배경화면 설정\r\n      await this.$refs.VueCanvasDrawing.drawBackgroundImage();\r\n      // 6. 그리기 위해 다시 원점 중앙 이동\r\n      this.$refs.VueCanvasDrawing.context.translate(this.imageWidth / 2.0, this.imageHeight / 2.0);*/\r\n      await this.$refs.VueCanvasDrawing.redraw();\r\n    },\r\n\r\n    checkedToggling(idx, name, bool) {\r\n      if (this.disable) {\r\n        if (idx[name] === bool) {\r\n          this.first.pan = false;\r\n          this.second.bright = false;\r\n          this.second.ruler = false;\r\n          this.second.tapeline = false;\r\n          this.second.draw = false;\r\n          idx[name] = !bool;\r\n        }\r\n      }\r\n    },\r\n\r\n    // utility ===================================================\r\n    // 1-1\r\n    startMoving(e) {\r\n      if (this.first.pan && !this.mouseFlag) {\r\n        this.startTop = e.screenY;\r\n        this.startLeft = e.screenX;\r\n        this.mouseFlag = true;\r\n      }\r\n    },\r\n    moveImage(e) {\r\n      if (this.first.pan && this.mouseFlag) {\r\n        this.movingTop += e.screenY - this.startTop;\r\n        this.startTop = e.screenY;\r\n        this.movingLeft += e.screenX - this.startLeft;\r\n        this.startLeft = e.screenX;\r\n      }\r\n    },\r\n    endMoving() {\r\n      if (this.first.pan && this.mouseFlag) {\r\n        this.mouseFlag = false;\r\n      }\r\n    },\r\n\r\n    // 1-2\r\n    changedScale(e) {\r\n      if (this.first.zoom) {\r\n        const rate = 0.002;\r\n        if (e.deltaY > 0 && this.scale >= 0.5 + rate) this.scale -= rate;\r\n        else if (e.deltaY < 0 && this.scale <= 2.0 - rate) this.scale += rate;\r\n      }\r\n    },\r\n\r\n    // 2-4\r\n    async startCoordinate(e) {\r\n      if (this.second.ruler) {\r\n        this.getCoordinate(e);\r\n        this.startX = this.x;\r\n        this.startY = this.y;\r\n      }\r\n    },\r\n\r\n    endCoordinate(e) {\r\n      if (this.second.ruler) {\r\n        this.getCoordinate(e);\r\n        this.endX = this.x;\r\n        this.endY = this.y;\r\n        this.getDistance([this.getWeb2One({x: this.startX, y: this.startY}),\r\n          this.getWeb2One({x: this.endX, y: this.endY})]);\r\n      }\r\n    },\r\n    getDistance(arr) {\r\n      // const rate = this.pW / this.fullHeight;\r\n      // const pixelSpacing = 0.10000000149011612;\r\n      let distance = 0;\r\n      let x = arr[0].x;\r\n      let y = arr[0].y;\r\n      arr.forEach(a => {\r\n        distance += Math.pow(Math.pow(y - a.y, 2) + Math.pow(x - a.x, 2), 0.5);\r\n        x = a.x;\r\n        y = a.y;\r\n      });\r\n      // Number.EPSILON = 오차없이 나타낼수 있는 가장 작은 양의 수, 부동 소수점 오차를 보정\r\n      distance = Math.round((distance + Number.EPSILON) * 100) / 100;\r\n      return distance.toFixed(2);\r\n    },\r\n\r\n    // 2-1, 2-3\r\n    changedMouseEvent(e) {\r\n      if (this.downFlag && this.second.bright) {\r\n        this.lock = this.second.bright;\r\n        this.preX = this.x;\r\n        this.preY = this.y;\r\n        this.getCoordinate(e);\r\n        if (this.preX < this.x || this.preY < this.y) {\r\n          this.brightness += 2;\r\n        } else if (this.preX > this.x || this.preY > this.y) {\r\n          this.brightness -= 2;\r\n        }\r\n      }\r\n    },\r\n\r\n    // event\r\n    // 2-2, 4-1, 4-2, 4-3, 4-3\r\n    async changedEvent(e) {\r\n      if (this.disable) {\r\n        if (e === 'inverse') {\r\n          // Change Inverse\r\n          // 2-2\r\n          if (this.second[e] === true) this.inverse = 100;\r\n          else this.inverse = 0;\r\n        } else if (typeof e === 'number') {\r\n          // Change Angle\r\n          // 4-1, 4-2, 4-3, 4-4\r\n          // @click=\"utilityEvent(i), send({'name' : k, 'state' : i }, [ang, rotX, rotY])\"\r\n          if (e === 0) {\r\n            this.$refs.VueCanvasDrawing.angle += 90;\r\n          } else if (e === 1) {\r\n            this.$refs.VueCanvasDrawing.angle -= 90;\r\n          } else if (e === 2) {\r\n            console.log(2);\r\n          } else if (e === 3) {\r\n            console.log(3);\r\n          }\r\n\r\n          /*if (e === 0) {\r\n            this.ang = (this.ang + 90) % 360\r\n          } else if (e === 1) {\r\n            if (this.ang === 0) this.ang = 360;\r\n            this.ang = (this.ang - 90) % 360\r\n          } else if (e === 2) {\r\n            if (this.ang === 90 || this.ang === 270) {\r\n              this.rotX = (this.rotX % 360) + 180;\r\n            } else {\r\n              this.rotY = (this.rotY % 360) + 180;\r\n            }\r\n          } else if (e === 3) {\r\n            if (this.ang === 0 || this.ang === 180) {\r\n              this.rotX = (this.rotX % 360) + 180;\r\n            } else {\r\n              this.rotY = (this.rotY % 360) + 180;\r\n            }\r\n          }*/\r\n          await this.drawing();\r\n          // await this.$refs.VueCanvasDrawing.context.rotate((Math.PI / 180) * this.$refs.VueCanvasDrawing.angle);\r\n          // await this.$refs.VueCanvasDrawing.redraw();\r\n        }\r\n        /*\r\n        // 화면 중앙에서 좌측 상단으로 변경\r\n        this.$refs.VueCanvasDrawing.context.translate(this.canvasWidth / this.reSizeScale / -2.0, this.canvasHeight / this.reSizeScale / -2.0);\r\n        */\r\n      }\r\n    },\r\n\r\n    // 2-4, 2-8, 2-9, 3-1\r\n    changedStrokeType(s) {\r\n      if (this.disable) {\r\n        if (s === 'zoom') {\r\n          this.lock = false;\r\n        } else if (s === 'ruler') {\r\n          this.strokeType = 'line';\r\n          this.lock = !this.second.ruler;\r\n        } else if (s === 'draw') {\r\n          this.strokeType = 'dash';\r\n          this.lock = !this.second.draw;\r\n        } else {\r\n          this.lock = true;\r\n        }\r\n      }\r\n    },\r\n\r\n    // 7-1, 7-2\r\n    clearView() {\r\n      this.first.pen = false;\r\n      this.first.zoom = false;\r\n\r\n      this.second.bright = false;\r\n      this.second.inverse = false;\r\n      this.second.sharpen = false;\r\n\r\n      this.scale = 1.0;\r\n\r\n      this.brightness = 100;\r\n      this.inverse = 0;\r\n\r\n      this.ang = 0;\r\n      this.rotX = 0;\r\n      this.rotY = 0;\r\n    },\r\n\r\n    /***\r\n     * One2         => Canvas  pen.style\r\n     * length       => line       0\r\n     * multi-length => tapeline\r\n     * angle        => line       0\r\n     * arrow        => line       1\r\n     * ellipse      => circle     1\r\n     * rectangle    => square     1\r\n     * freedraw     => dash       1\r\n     * */\r\n    // One2 --> Web\r\n    async importImageDrawing() {\r\n      this.$refs.VueCanvasDrawing.context.clearRect(0, 0, this.canvasWidth, this.canvasHeight);\r\n      // 2. 트랜스레이트 -> 화면의 중앙으로 이동\r\n      this.$refs.VueCanvasDrawing.context.translate(this.canvasWidth / this.reSizeScale / 2.0, this.canvasHeight / this.reSizeScale / 2.0);\r\n\r\n      // 3. 로테이트 -> 효과 적용\r\n      this.$refs.VueCanvasDrawing.context.rotate((Math.PI / 180) * this.$refs.VueCanvasDrawing.angle);\r\n      console.log('rotate angle ' + this.$refs.VueCanvasDrawing.angle);\r\n      // 4. 트랜스레이트 -> 화면의 중앙에서 그림 박기 위한 0, 0으로 이동\r\n      this.$refs.VueCanvasDrawing.context.translate(this.imageWidth / -2.0, this.imageHeight / -2.0);\r\n      await this.$refs.VueCanvasDrawing.setBackground();\r\n\r\n      // 5. 그리기 위해 다시 원점 중앙 이동\r\n      this.$refs.VueCanvasDrawing.context.translate(this.imageWidth / 2.0, this.imageHeight / 2.0);\r\n\r\n      for (const m of this.tempOverlaies) {\r\n        let distance;\r\n        // 선 속성 지정\r\n        this.lineColor = '#' + m.style.pen.color.substring(3, 9);\r\n        this.lineWidth = m.style.pen.width / this.reSizeScale;\r\n        const stroke = {\r\n          type: '',\r\n          from: {\r\n            x: 0,\r\n            y: 0,\r\n          },\r\n          coordinates: [],\r\n          color: this.lineColor,\r\n          width: this.lineWidth,\r\n          fill: false,\r\n          lineCap: \"round\",\r\n          lineJoin: \"round\",\r\n        };\r\n\r\n        switch (m.type) {\r\n          case \"freedraw\":\r\n            stroke.type = \"dash\";\r\n            stroke.from.x = m.scene_pos['control-points'][0].x / 25.4 * 96;\r\n            stroke.from.y = m.scene_pos['control-points'][0].y / 25.4 * 96;\r\n            m.scene_pos['control-points'].forEach(p => {\r\n              stroke.coordinates.push({x: p.x / 25.4 * 96, y: p.y / 25.4 * 96});\r\n            })\r\n            this.$refs.VueCanvasDrawing.drawShape(this.$refs.VueCanvasDrawing.context, stroke, false);\r\n            this.$refs.VueCanvasDrawing.images.push(stroke);\r\n            break;\r\n          case \"length\":\r\n            stroke.type = \"line\";\r\n            stroke.from.x = m.scene_pos.start.x / 25.4 * 96;\r\n            stroke.from.y = m.scene_pos.start.y / 25.4 * 96;\r\n            stroke.coordinates.push({\r\n              x: m.scene_pos.end.x / 25.4 * 96,\r\n              y: m.scene_pos.end.y / 25.4 * 96,\r\n              valueBox: m.scene_pos[\"value-box\"]\r\n            });\r\n            distance = this.getDistance([{x: m.scene_pos.start.x, y: m.scene_pos.start.y},\r\n              {x: m.scene_pos.end.x, y: m.scene_pos.end.y}]);\r\n            // 단위 표시하기\r\n            this.$refs.VueCanvasDrawing.context.fillStyle = \"#ffff00\";\r\n            this.$refs.VueCanvasDrawing.context.fillText(distance + ' mm', m.scene_pos[\"value-box\"].x / 25.4 * 96, m.scene_pos[\"value-box\"].y / 25.4 * 96);\r\n            this.$refs.VueCanvasDrawing.drawShape(this.$refs.VueCanvasDrawing.context, stroke, false);\r\n            this.$refs.VueCanvasDrawing.images.push(stroke);\r\n            break;\r\n          case \"multi-length\":\r\n            stroke.type = \"tapeline\";\r\n            stroke.from.x = m.scene_pos['control-points'][0].x / 25.4 * 96;\r\n            stroke.from.y = m.scene_pos['control-points'][0].y / 25.4 * 96;\r\n            m.scene_pos['control-points'].forEach(p => {\r\n              stroke.coordinates.push({x: p.x / 25.4 * 96, y: p.y / 25.4 * 96});\r\n            })\r\n            distance = this.getDistance(m.scene_pos['control-points']);\r\n            // 단위 표시하기\r\n            this.$refs.VueCanvasDrawing.context.fillStyle = \"#ffff00\";\r\n            this.$refs.VueCanvasDrawing.context.fillText(distance + ' mm', m.scene_pos[\"value-box\"].x / 25.4 * 96, m.scene_pos[\"value-box\"].y / 25.4 * 96);\r\n            this.$refs.VueCanvasDrawing.drawShape(this.$refs.VueCanvasDrawing.context, stroke, false);\r\n            this.$refs.VueCanvasDrawing.images.push(stroke);\r\n            break;\r\n        }\r\n      }\r\n      // this.$refs.VueCanvasDrawing.context.restore();\r\n    },\r\n\r\n    async setCanvasScale(){\r\n      this.$refs.VueCanvasDrawing.context.save();\r\n      this.$refs.VueCanvasDrawing.context.font = \"10px serif\"\r\n      this.$refs.VueCanvasDrawing.context.textAlign = \"start\"\r\n      this.$refs.VueCanvasDrawing.context.textBaseline = \"alphabetic\";\r\n\r\n      this.reSizeScale = Math.min(this.canvasHeight / this.imageHeight, this.canvasWidth / this.imageWidth);\r\n      // 1. 스케일 -> 캔바스 스케일을 높이와 너비 중 짧은 걸 기준으로 맞춤\r\n      this.$refs.VueCanvasDrawing.context.scale(this.reSizeScale, this.reSizeScale);\r\n      console.log('set Canvas Scale:: ' + this.reSizeScale);\r\n\r\n    },\r\n\r\n    async drawing(){\r\n      // await this.setCanvasScale();\r\n      const canvasHeight = Number(this.height);\r\n      const canvasWidth = Number(this.width);\r\n      const pixelspacing = 0.100000001;\r\n      let dHeight = (this.$refs.VueCanvasDrawing.loadedImage.height * pixelspacing) / 25.4 * 96;\r\n      let dWidth = (this.$refs.VueCanvasDrawing.loadedImage.width * pixelspacing) / 25.4 * 96;\r\n\r\n      this.$refs.VueCanvasDrawing.context.clearRect(canvasWidth / -2.0, canvasHeight / -2.0, canvasWidth, canvasHeight);\r\n      // 2. 트랜스레이트 -> 화면의 중앙으로 이동\r\n      // 4. 트랜스레이트 -> 화면의 중앙에서 그림 박기 위한 0, 0으로 이동\r\n      this.$refs.VueCanvasDrawing.context.translate(dWidth / -2.0, dHeight / -2.0);\r\n      await this.$refs.VueCanvasDrawing.setBackground().then(() => {\r\n        if (this.context) {\r\n          // 5. 그리기 위해 다시 원점 중앙 이동\r\n          this.$refs.VueCanvasDrawing.context.translate(dWidth / 2.0, dHeight / 2.0);\r\n          this.$refs.VueCanvasDrawing.images.forEach(stroke => {\r\n            if (stroke.type !== 'circle' || stroke.type === 'circle' && stroke.coordinates.length > 0) {\r\n              this.$refs.VueCanvasDrawing.drawShape(this.$refs.VueCanvasDrawing.context, stroke,\r\n                  stroke.type === 'eraser' ||\r\n                  stroke.type === 'dash' ||\r\n                  stroke.type === 'line' ||\r\n                  stroke.type === 'tapeline' ||\r\n                  stroke.type === 'angle' ||\r\n                  stroke.type === 'arrow' ? false : true);\r\n            }\r\n          });\r\n        }\r\n      });\r\n    },\r\n\r\n    // Web --> One2\r\n    async save() {\r\n      await this.getRefImage2Overlayes();\r\n      var data = {\r\n        \"manipulate\": {\"effect\": {\"invert\": this.second.inverse, \"sharpen\": 0}, \"windowing\": {\"wc\": 1000, \"ww\": 4000}},\r\n        \"overlaies\": this.overlayes\r\n      }\r\n\r\n      // const obj = JSON.parse(json);\r\n      const s = JSON.stringify(data);\r\n      axios({\r\n        url: drf.patient.saveDrwingMarker('1.2.410.200062.2.1.20221222144825737.86.125615.843.799'),\r\n        method: 'post',\r\n        data: s\r\n      })\r\n    },\r\n\r\n    // async setImage(event) {\r\n    //   let URL = window.URL;\r\n    //   this.backgroundImage = URL.createObjectURL(event.target.files[0]);\r\n    //   await this.$refs.VueCanvasDrawing.redraw();\r\n    // },\r\n\r\n    getCoordinate(event) {\r\n      if (this.disable) {\r\n        let coordinates = this.$refs.VueCanvasDrawing.getCoordinates(event);\r\n        this.x = coordinates.x;\r\n        this.y = coordinates.y;\r\n      }\r\n    },\r\n\r\n    getWeb2One(coordiX, coordiY) {\r\n      return {x: (coordiX - this.maginLeft) / this.rated, y: (coordiY - this.canvasHeight) / this.rated};\r\n    },\r\n\r\n    /***\r\n     * Canvas     => One2         pen.style\r\n     * line       => length         0\r\n     * tapeline   => multi-length\r\n     * angle      => angle          0\r\n     * arrow      => arrow          1\r\n     * ellipse    => circle         1\r\n     * rectangle  => square         1\r\n     * dash       => freedraw       1\r\n     * */\r\n    // Web --> One2\r\n    getRefImage2Overlayes() {\r\n      this.$refs.VueCanvasDrawing.images.forEach(e => {\r\n        const data = {\"style\": {}};\r\n        let coordi, coordi2;\r\n        const scene_pos = {};\r\n        const start = {}, end = {}\r\n        const value_box = {};\r\n        let dataType;\r\n        let newArr;\r\n        switch (e.type) {\r\n          case \"dash\":\r\n            newArr = e.coordinates.map(c => {\r\n              coordi = this.getWeb2One(c.x, c.y);\r\n              return {x: coordi.x, y: coordi.y};\r\n            })\r\n            scene_pos[\"control-points\"] = newArr;\r\n            data[\"style\"][\"brush\"] = {\"color\": \"#00ffffff\"};\r\n            dataType = \"freedraw\";\r\n            break;\r\n          case \"line\":\r\n            coordi = this.getWeb2One(e.from.x, e.from.y);\r\n            start[\"x\"] = coordi.x;\r\n            start[\"y\"] = coordi.y;\r\n            coordi = this.getWeb2One(e.coordinates[0].x, e.coordinates[0].y);\r\n            end[\"x\"] = coordi.x;\r\n            end[\"y\"] = coordi.y;\r\n            value_box[\"x\"] = e.coordinates[0].valueBox.x;\r\n            value_box[\"y\"] = e.coordinates[0].valueBox.y;\r\n            scene_pos[\"start\"] = start;\r\n            scene_pos[\"end\"] = end;\r\n            scene_pos[\"value-box\"] = value_box;\r\n            data[\"style\"][\"value-box\"] = {\r\n              \"brush\": {\"color\": \"#00ffffff\"},\r\n              \"pen\": {\"cap\": 32, \"color\": \"#00ffffff\", \"join\": 128, \"style\": 0, \"width\": 0},\r\n              \"text\": {\"color\": \"#ffffd700\", \"font-size\": 12}\r\n            };\r\n            dataType = \"length\";\r\n            break;\r\n          case \"tapeline\":\r\n            break;\r\n          case \"angle\":\r\n            break;\r\n          case \"arrow\":\r\n            coordi = this.getWeb2One(e.from.x, e.from.y);\r\n            start[\"x\"] = coordi.x;\r\n            start[\"y\"] = coordi.y;\r\n            coordi = this.getWeb2One(e.coordinates[0].x, e.coordinates[0].y);\r\n            end[\"x\"] = coordi.x;\r\n            end[\"y\"] = coordi.y;\r\n            scene_pos[\"start\"] = start;\r\n            scene_pos[\"end\"] = end;\r\n            data[\"style\"][\"brush\"] = {\"color\": \"#00ffffff\"};\r\n            dataType = \"arrow\";\r\n            break;\r\n          case \"circle\":\r\n            coordi = this.getWeb2One(e.coordinates[0].x - e.coordinates[1].x, e.coordinates[0].y - e.coordinates[1].y);\r\n            coordi2 = this.getWeb2One(e.coordinates[0].x + e.coordinates[1].x, e.coordinates[0].y + e.coordinates[1].y);\r\n            scene_pos[\"bottom\"] = coordi2.y;\r\n            scene_pos[\"left\"] = coordi.x;\r\n            scene_pos[\"right\"] = coordi2.x;\r\n            scene_pos[\"top\"] = coordi.y;\r\n            data[\"style\"][\"brush\"] = {\"color\": \"#00ffffff\"};\r\n            dataType = \"ellipse\";\r\n            break;\r\n          case \"square\":\r\n            // from:: 시작점, left - top\r\n            coordi = this.getWeb2One(e.coordinates[3].x, e.coordinates[3].y);\r\n            coordi2 = this.getWeb2One(e.coordinates[1].x, e.coordinates[1].y);\r\n            scene_pos[\"bottom\"] = coordi2.y;\r\n            scene_pos[\"left\"] = coordi.x;\r\n            scene_pos[\"right\"] = coordi2.x;\r\n            scene_pos[\"top\"] = coordi.y;\r\n            data[\"style\"][\"brush\"] = {\"color\": \"#00ffffff\"};\r\n            dataType = \"rectangle\";\r\n            break;\r\n        }\r\n\r\n        if (e.coordinates.length !== 0) {\r\n          // 1. scene_pos\r\n          data[\"scene_pos\"] = scene_pos;\r\n          // 2. style\r\n          data[\"style\"][\"pen\"] = {\r\n            \"cap\": 32,\r\n            \"color\": '#ff' + e.color.substring(1),\r\n            \"join\": 128,\r\n            \"style\": 1,\r\n            \"width\": e.width\r\n          };\r\n          // 3. transformation\r\n          data[\"transformation\"] = {\"rot_deg\": 0};\r\n          // 4. type\r\n          data[\"type\"] = dataType;\r\n          this.overlayes.push(data);\r\n        }\r\n      })\r\n    },\r\n\r\n    ...mapActions([\r\n      Constant.GET_PATIENTSERIESLIST,\r\n    ]),\r\n  },\r\n}\r\n</script>\r\n\r\n<style>\r\n.baseHeaderView {\r\n  background-color: black;\r\n  width: 100%;\r\n  height: calc(100% - 80px);\r\n  display: flex;\r\n}\r\n\r\n.baseUtilityView {\r\n  /* debug용 */\r\n  /*background-color: orange;*/\r\n  background-color: black;\r\n  height: 100%;\r\n  width: 100%;\r\n  position: relative;\r\n  /*justify-content: flex-start;*/\r\n  /*overflow: auto;*/\r\n\r\n  justify-content: center;\r\n  overflow: hidden;\r\n}\r\n\r\n.isToggle {\r\n  border: solid 2px blue;\r\n}\r\n\r\n/* mainImg에 적용 되는 event\r\n.mainImg {\r\n  position: absolute;\r\n  object-fit: contain;\r\n  height: calc(1px * v-bind(screenHeight));\r\n  width: calc(1px * v-bind(screenWidth));\r\n  top: calc(1px * v-bind(movingTop));\r\n  left: calc(1px * v-bind(movingLeft));\r\n}\r\n\r\n.utilityEvent {\r\n  !*overflow: hidden;*!\r\n  !* 2-1, 2-2, *!\r\n  filter: brightness(calc(1% * v-bind(brightness))) invert(calc(1% * v-bind(inverse)));\r\n\r\n  !* 1-2, 4-1, 4-2, 4-3, 4-4 *!\r\n  transform: scale(v-bind('scale')) rotate(calc(1deg * v-bind(ang))) rotateX(calc(1deg * v-bind(rotX))) rotateY(calc(1deg * v-bind(rotY)));\r\n}*/\r\n\r\n/* 2-3 */\r\n.sharpen {\r\n  image-rendering: pixelated;\r\n}\r\n\r\n.canvasEvent {\r\n  /*height: calc(1px * v-bind(canvasHeight));*/\r\n  height: calc(v-bind(canvasHeight) * 1px);\r\n  /*height: 500px;*/\r\n  /*width: calc(1px * v-bind(canvasWidth));*/\r\n  width: calc(v-bind(canvasWidth) * 1px);\r\n  /*width: 500px;*/\r\n\r\n  /*z-index: 10;*/\r\n  border: solid 1px #FF0000;\r\n  position: absolute;\r\n  /*top: calc(-1px * (v-bind(maginTop) - v-bind(movingTop)));*/\r\n  /*left: calc(1px * v-bind(movingLeft));*/\r\n  top: calc(1px * v-bind(movingTop));\r\n  left: calc(1px * v-bind(movingLeft));\r\n\r\n  /*transform: scale(v-bind('scale')) rotate(calc(1deg * v-bind(ang))) rotateX(calc(1deg * v-bind(rotX))) rotateY(calc(1deg * v-bind(rotY)));*/\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}